"use strict";(self.webpackChunkthreejs_examples_with_fiber=self.webpackChunkthreejs_examples_with_fiber||[]).push([[901],{6831:function(e,r,n){n.r(r),n.d(r,{default:function(){return C}});var t=n(2791),a=n(4150),o=n(9439),i=n(7760),c=n(2794);var u=n(4925),s=n(7462),l=n(5671),f=n(3144),d=n(1752),m=n(1120),p=n(136),v=n(9388),h=function(e){(0,p.Z)(n,e);var r=(0,v.Z)(n);function n(e){var t;return(0,l.Z)(this,n),(t=r.call(this,e)).type=i.HalfFloatType,t}return(0,f.Z)(n,[{key:"parse",value:function(e){var r=function(e,r){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(r||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(r||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(r||""));break;default:console.error("THREE.RGBELoader: Error: "+(r||""))}return-1},n=function(e,r,n){r=r||1024;for(var t=e.pos,a=-1,o=0,i="",c=String.fromCharCode.apply(null,new Uint16Array(e.subarray(t,t+128)));0>(a=c.indexOf("\n"))&&o<r&&t<e.byteLength;)i+=c,o+=c.length,t+=128,c+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(t,t+128)));return-1<a&&(!1!==n&&(e.pos+=o+a+1),i+c.slice(0,a))},t=function(e,r,n,t){var a=e[r+3],o=Math.pow(2,a-128)/255;n[t+0]=e[r+0]*o,n[t+1]=e[r+1]*o,n[t+2]=e[r+2]*o,n[t+3]=1},a=function(e,r,n,t){var a=e[r+3],o=Math.pow(2,a-128)/255;n[t+0]=i.DataUtils.toHalfFloat(Math.min(e[r+0]*o,65504)),n[t+1]=i.DataUtils.toHalfFloat(Math.min(e[r+1]*o,65504)),n[t+2]=i.DataUtils.toHalfFloat(Math.min(e[r+2]*o,65504)),n[t+3]=i.DataUtils.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;var c=function(e){var t,a,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,c=/^\s*FORMAT=(\S+)\s*$/,u=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(t=n(e)))return r(1,"no header found");if(!(a=t.match(/^#\?(\S+)/)))return r(3,"bad initial token");for(s.valid|=1,s.programtype=a[1],s.string+=t+"\n";!1!==(t=n(e));)if(s.string+=t+"\n","#"!==t.charAt(0)){if((a=t.match(o))&&(s.gamma=parseFloat(a[1])),(a=t.match(i))&&(s.exposure=parseFloat(a[1])),(a=t.match(c))&&(s.valid|=2,s.format=a[1]),(a=t.match(u))&&(s.valid|=4,s.height=parseInt(a[1],10),s.width=parseInt(a[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=t+"\n";return 2&s.valid?4&s.valid?s:r(3,"missing image size specifier"):r(3,"missing format specifier")}(o);if(-1!==c){var u=c.width,s=c.height,l=function(e,n,t){var a=n;if(a<8||a>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(a!==(e[2]<<8|e[3]))return r(3,"wrong scanline width");var o=new Uint8Array(4*n*t);if(!o.length)return r(4,"unable to allocate buffer space");for(var i=0,c=0,u=4*a,s=new Uint8Array(4),l=new Uint8Array(u),f=t;f>0&&c<e.byteLength;){if(c+4>e.byteLength)return r(1);if(s[0]=e[c++],s[1]=e[c++],s[2]=e[c++],s[3]=e[c++],2!=s[0]||2!=s[1]||(s[2]<<8|s[3])!=a)return r(3,"bad rgbe scanline format");for(var d=0,m=void 0;d<u&&c<e.byteLength;){var p=(m=e[c++])>128;if(p&&(m-=128),0===m||d+m>u)return r(3,"bad scanline data");if(p)for(var v=e[c++],h=0;h<m;h++)l[d++]=v;else l.set(e.subarray(c,c+m),d),d+=m,c+=m}for(var g=a,b=0;b<g;b++){var y=0;o[i]=l[b+y],y+=a,o[i+1]=l[b+y],y+=a,o[i+2]=l[b+y],y+=a,o[i+3]=l[b+y],i+=4}f--}return o}(o.subarray(o.pos),u,s);if(-1!==l){var f,d,m;switch(this.type){case i.FloatType:m=l.length/4;for(var p=new Float32Array(4*m),v=0;v<m;v++)t(l,4*v,p,4*v);f=p,d=i.FloatType;break;case i.HalfFloatType:m=l.length/4;for(var h=new Uint16Array(4*m),g=0;g<m;g++)a(l,4*g,h,4*g);f=h,d=i.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:u,height:s,data:f,header:c.string,gamma:c.gamma,exposure:c.exposure,format:undefined,type:d}}}return null}},{key:"setDataType",value:function(e){return this.type=e,this}},{key:"load",value:function(e,r,t,a){return(0,d.Z)((0,m.Z)(n.prototype),"load",this).call(this,e,(function(e,n){switch(e.type){case i.FloatType:case i.HalfFloatType:e.encoding=i.LinearEncoding,e.minFilter=i.LinearFilter,e.magFilter=i.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}r&&r(e,n)}),t,a)}}]),n}(i.DataTextureLoader),g={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"},b=["args","children"];function y(e){var r=e+"BufferGeometry";return t.forwardRef((function(e,n){var a=e.args,o=e.children,i=(0,u.Z)(e,b);return t.createElement("mesh",(0,s.Z)({ref:n},i),t.createElement(r,{attach:"geometry",args:a}),o)}))}y("box"),y("circle"),y("cone"),y("cylinder"),y("sphere"),y("plane"),y("tube"),y("torus"),y("torusKnot"),y("tetrahedron"),y("ring"),y("polyhedron");var E=y("icosahedron"),k=(y("octahedron"),y("dodecahedron"),y("extrude"),y("lathe"),["background","scene"]),_=function(e){return(r=e).current&&r.current.isScene?e.current:e;var r};function w(e){var r=e.scene,n=e.background,a=void 0!==n&&n,o=e.map,i=(0,c.w)((function(e){return e.scene}));return t.useLayoutEffect((function(){if(o){var e=_(r||i),n=e.background,t=e.environment;return"only"!==a&&(e.environment=o),a&&(e.background=o),function(){"only"!==a&&(e.environment=t),a&&(e.background=n)}}}),[i,r,o,a]),null}function x(e){var r=e.files,n=void 0===r?["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"]:r,t=e.path,a=void 0===t?"":t,o=e.preset,u=void 0===o?void 0:o,s=e.extensions;if(u){if(!(u in g))throw new Error("Preset must be one of: "+Object.keys(g).join(", "));n=g[u],a="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}var l=Array.isArray(n),f=l?i.CubeTextureLoader:h,d=(0,c.z)(f,l?[n]:n,(function(e){e.setPath(a),s&&s(e)})),m=l?d[0]:d;return m.mapping=l?i.CubeReflectionMapping:i.EquirectangularReflectionMapping,m}function M(e){var r=e.background,n=void 0!==r&&r,a=e.scene,o=x((0,u.Z)(e,k)),i=(0,c.w)((function(e){return e.scene}));return t.useLayoutEffect((function(){var e=_(a||i),r=e.background,t=e.environment;return"only"!==n&&(e.environment=o),n&&(e.background=o),function(){"only"!==n&&(e.environment=t),n&&(e.background=r)}}),[o,n,a,i]),null}function P(e){var r=e.children,n=e.near,a=void 0===n?1:n,u=e.far,s=void 0===u?1e3:u,l=e.resolution,f=void 0===l?256:l,d=e.frames,m=void 0===d?1:d,p=e.map,v=e.background,h=void 0!==v&&v,g=e.scene,b=e.files,y=e.path,E=e.preset,k=void 0===E?void 0:E,x=e.extensions,P=(0,c.w)((function(e){return e.gl})),T=(0,c.w)((function(e){return e.scene})),F=t.useRef(null),L=t.useState((function(){return new i.Scene})),U=(0,o.Z)(L,1)[0],A=t.useMemo((function(){var e=new i.WebGLCubeRenderTarget(f);return e.texture.type=i.HalfFloatType,e}),[f]);t.useLayoutEffect((function(){1===m&&F.current.update(P,U);var e=_(g||T),r=e.background,n=e.environment;return"only"!==h&&(e.environment=A.texture),h&&(e.background=A.texture),function(){"only"!==h&&(e.environment=n),h&&(e.background=r)}}),[r,U,A.texture,g,T,h,m,P]);var j=1;return(0,c.x)((function(){(m===1/0||j<m)&&(F.current.update(P,U),j++)})),t.createElement(t.Fragment,null,(0,c.g)(t.createElement(t.Fragment,null,r,t.createElement("cubeCamera",{ref:F,args:[a,s,A]}),b||k?t.createElement(M,{background:!0,files:b,preset:k,path:y,extensions:x}):p?t.createElement(w,{background:!0,map:p,extensions:x}):null),U))}function T(e){var r,n,a,o,c,u=x(e),l=e.map||u,f=(c=l)&&c.isCubeTexture,d=t.useMemo((function(){var e,r,n=(null!==(e=f?null==(r=l.image[0])?void 0:r.width:l.image.width)&&void 0!==e?e:1024)/4,t=Math.floor(Math.log2(n)),a=Math.pow(2,t),o=3*Math.max(a,112),i=4*a;return[f?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH ".concat(1/o),"#define CUBEUV_TEXEL_HEIGHT ".concat(1/i),"#define CUBEUV_MAX_MIP ".concat(t,".0"),""]}),[]),m=t.useMemo((function(){return d.join("\n")+"#define GLSLIFY 1\n#define ENVMAP_TYPE_CUBE_UV\nvarying vec3 vWorldPosition;uniform float radius;uniform float height;\n#ifdef ENVMAP_TYPE_CUBE\nuniform samplerCube cubemap;\n#else\nuniform sampler2D cubemap;\n#endif\nfloat diskIntersect(in vec3 ro,in vec3 rd,vec3 c,vec3 n,float r){vec3 o=ro-c;float t=-dot(n,o)/dot(rd,n);vec3 q=o+rd*t;return(dot(q,q)<r*r)? t : 1e6;}float sphereIntersect(in vec3 ro,in vec3 rd,in vec3 ce,float ra){vec3 oc=ro-ce;float b=dot(oc,rd);float c=dot(oc,oc)-ra*ra;float h=b*b-c;if(h<0.0)-1.0;h=sqrt(h);return-b+h;}vec3 project(){vec3 p=normalize(vWorldPosition);vec3 camPos=cameraPosition;camPos.y-=height;float intersection=sphereIntersect(camPos,p,vec3(0.),radius);if(intersection>0.){vec3 h=vec3(0.0,-height,0.0);float intersection2=diskIntersect(camPos,p,h,vec3(0.0,-1.0,0.0),radius);p=(camPos+min(intersection,intersection2)*p)/radius;}else{p=vec3(0.0,1.0,0.0);}return p;}\n#include <common>\n#include <cube_uv_reflection_fragment>\nvoid main(){vec3 projectedWorldPosition=project();\n#ifdef ENVMAP_TYPE_CUBE\nvec3 outcolor=textureCube(cubemap,projectedWorldPosition).rgb;\n#else\nvec3 direction=normalize(projectedWorldPosition);vec2 uv=equirectUv(direction);vec3 outcolor=texture2D(cubemap,uv).rgb;\n#endif\ngl_FragColor=vec4(outcolor,1.0);\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n}"}),[d]),p=t.useMemo((function(){return{cubemap:{value:null},height:{value:15},radius:{value:60}}}),[]),v=t.useRef(null),h=null==(r=e.ground)?void 0:r.height,g=null==(n=e.ground)?void 0:n.radius,b=null!==(a=null==(o=e.ground)?void 0:o.scale)&&void 0!==a?a:1e3;return t.useEffect((function(){h&&(v.current.uniforms.height.value=h)}),[h]),t.useEffect((function(){g&&(v.current.uniforms.radius.value=g)}),[g]),t.useEffect((function(){v.current.uniforms.cubemap.value=l}),[l]),t.createElement(t.Fragment,null,t.createElement(w,(0,s.Z)({},e,{map:l})),t.createElement(E,{scale:b,args:[1,16]},t.createElement("shaderMaterial",{ref:v,side:i.BackSide,vertexShader:"#define GLSLIFY 1\nvarying vec3 vWorldPosition;void main(){vec4 worldPosition=modelMatrix*vec4(position,1.0);vWorldPosition=worldPosition.xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",fragmentShader:m,uniforms:p,depthTest:!1})))}function F(e){return e.ground?t.createElement(T,e):e.map?t.createElement(w,e):e.children?t.createElement(P,e):t.createElement(M,e)}var L=n(3655),U=n(3520),A=n.p+"static/media/LittlestTokyo.eb53c2396bb6b4d5b117.glb",j=n(184);L.L.preload(A);var R=function(){var e=(0,L.L)(A),r=e.scene,n=function(e,r){var n=t.useRef(),a=t.useState((function(){return r?r instanceof i.Object3D?{current:r}:r:n})),u=(0,o.Z)(a,1)[0],s=t.useState((function(){return new i.AnimationMixer(void 0)})),l=(0,o.Z)(s,1)[0],f=t.useRef({}),d=t.useState((function(){var r={};return e.forEach((function(e){return Object.defineProperty(r,e.name,{enumerable:!0,get:function(){if(u.current)return f.current[e.name]||(f.current[e.name]=l.clipAction(e,u.current))}})})),{ref:u,clips:e,actions:r,names:e.map((function(e){return e.name})),mixer:l}})),m=(0,o.Z)(d,1)[0];return(0,c.x)((function(e,r){return l.update(r)})),t.useEffect((function(){var e=u.current;return function(){f.current={},Object.values(m.actions).forEach((function(r){e&&l.uncacheAction(r,e)}))}}),[e]),m}(e.animations,r),a=n.actions;return(0,t.useEffect)((function(){var e;null===(e=a["Take 001"])||void 0===e||e.play()}),[a,r]),(0,j.jsx)("primitive",{object:r,scale:[.01,.01,.01],position:[1,1,0]})},C=function(){return(0,j.jsxs)(a.Xz,{camera:{position:[5,2,8],fov:40,near:1,far:100},dpr:[1,2],children:[(0,j.jsx)("color",{attach:"background",args:[12575709]}),(0,j.jsx)(F,{preset:"warehouse"}),(0,j.jsx)(t.Suspense,{fallback:null,children:(0,j.jsx)(R,{})}),(0,j.jsx)(U.z,{target:[0,.5,0],enableDamping:!0,enablePan:!1})]})}}}]);
//# sourceMappingURL=901.333a5733.chunk.js.map